<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="SQLite是一个使用C语言编写的体积超小的嵌入式数据库, 一个数据库就是一个文件. 由于体积小并且迅速, 所以SQLite经常被嵌入到一些iOS或者Android的应用程序中. 这不, 在Python3的标准库中就嵌入了一个SQLite. 接下来我们就来说说这个小家伙以及怎么使用Python3的SQLite的标准库.">
<meta property="og:type" content="article">
<meta property="og:title" content="SQLite3与Python3">
<meta property="og:url" content="https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/index.html">
<meta property="og:site_name" content="Yaoxuannn&#39;s Blog">
<meta property="og:description" content="SQLite是一个使用C语言编写的体积超小的嵌入式数据库, 一个数据库就是一个文件. 由于体积小并且迅速, 所以SQLite经常被嵌入到一些iOS或者Android的应用程序中. 这不, 在Python3的标准库中就嵌入了一个SQLite. 接下来我们就来说说这个小家伙以及怎么使用Python3的SQLite的标准库.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-12-19T03:15:22.000Z">
<meta property="article:modified_time" content="2020-11-30T01:24:55.000Z">
<meta property="article:author" content="Yaoxuan Wei">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="SQLite">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SQLite3与Python3</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-09NWQ40K0B"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-09NWQ40K0B');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2018/03/04/%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0%E5%AD%98%E6%A1%A3/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2017/12/13/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&text=SQLite3与Python3"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&is_video=false&description=SQLite3与Python3"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQLite3与Python3&body=Check out this article: https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&name=SQLite3与Python3&description=&lt;p&gt;SQLite是一个使用C语言编写的体积超小的嵌入式数据库, 一个数据库就是一个文件. 由于体积小并且迅速, 所以SQLite经常被嵌入到一些iOS或者Android的应用程序中. 这不, 在Python3的标准库中就嵌入了一个SQLite.&lt;/p&gt;
&lt;p&gt;接下来我们就来说说这个小家伙以及怎么使用Python3的SQLite的标准库.&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&t=SQLite3与Python3"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLite"><span class="toc-number">1.</span> <span class="toc-text">SQLite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLite%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.</span> <span class="toc-text">SQLite的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-x3D-%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">数据库 &#x3D; 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">1.3.</span> <span class="toc-text">表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLite%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">SQLite中的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-%E5%88%A0%E9%99%A4"><span class="toc-number">1.5.</span> <span class="toc-text">创建 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5-%E6%9F%A5%E6%89%BE-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4"><span class="toc-number">1.6.</span> <span class="toc-text">插入 查找 修改 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%8F%A5"><span class="toc-number">1.7.</span> <span class="toc-text">子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.</span> <span class="toc-text">高级查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.9.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.10.</span> <span class="toc-text">事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E7%9A%84SQLITE%E5%BA%93"><span class="toc-number">2.</span> <span class="toc-text">Python的SQLITE库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97-sqlite3"><span class="toc-number">2.1.</span> <span class="toc-text">模块 sqlite3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB-Connection"><span class="toc-number">2.2.</span> <span class="toc-text">类 Connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB-Cursor"><span class="toc-number">2.3.</span> <span class="toc-text">类 Cursor</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        SQLite3与Python3
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Yaoxuan Wei</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-12-19T03:15:22.000Z" class="dt-published" itemprop="datePublished">2017-12-18</time>
        
        (Updated: <time datetime="2020-11-30T01:24:55.000Z" class="dt-updated" itemprop="dateModified">2020-11-29</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Python/" rel="tag">Python</a>, <a class="p-category" href="/tags/SQLite/" rel="tag">SQLite</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>SQLite是一个使用C语言编写的体积超小的嵌入式数据库, 一个数据库就是一个文件. 由于体积小并且迅速, 所以SQLite经常被嵌入到一些iOS或者Android的应用程序中. 这不, 在Python3的标准库中就嵌入了一个SQLite.</p>
<p>接下来我们就来说说这个小家伙以及怎么使用Python3的SQLite的标准库.</p>
<span id="more"></span>

<h2 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h2><p>很久之前我们就看过了Python3操作MySQL的操作, 现在SQLite和MySQL一样都是符合ACID的数据库, 但是稍微我们还是要了解一下他的. 来看看它有哪些神奇的特性和命令.</p>
<h3 id="SQLite的命令"><a href="#SQLite的命令" class="headerlink" title="SQLite的命令"></a>SQLite的命令</h3><p>SQLite提供了很多有用的命令, 这些命令都不使用分号<code>;</code>结尾, 却是使用.号<code>.</code>开头的.  我们来看一下都有哪些, 在shell的模式下, 使用<code>.help</code>命令就可以获得所有的SQLite命令.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .help</span><br><span class="line">.auth ON|OFF           Show authorizer callbacks</span><br><span class="line">.backup ?DB? FILE      Backup DB (default &quot;main&quot;) to FILE</span><br><span class="line">.bail on|off           Stop after hitting an error.  Default OFF</span><br><span class="line">.binary on|off         Turn binary output on or off.  Default OFF</span><br><span class="line">.changes on|off        Show number of rows changed by SQL</span><br><span class="line">.check GLOB            Fail if output since .testcase does not match</span><br><span class="line">.clone NEWDB           Clone data into NEWDB from the existing database</span><br><span class="line">.databases             List names and files of attached databases</span><br><span class="line">.dbinfo ?DB?           Show status information about the database</span><br><span class="line">.dump ?TABLE? ...      Dump the database in an SQL text format</span><br><span class="line">                         If TABLE specified, only dump tables matching</span><br><span class="line">                         LIKE pattern TABLE.</span><br><span class="line">.echo on|off           Turn command echo on or off</span><br><span class="line">.eqp on|off|full       Enable or disable automatic EXPLAIN QUERY PLAN</span><br><span class="line">.exit                  Exit this program</span><br><span class="line">.explain ?on|off|auto? Turn EXPLAIN output mode on or off or to automatic</span><br><span class="line">.fullschema ?--indent? Show schema and the content of sqlite_stat tables</span><br><span class="line">.headers on|off        Turn display of headers on or off</span><br><span class="line">.help                  Show this message</span><br><span class="line">.import FILE TABLE     Import data from FILE into TABLE</span><br><span class="line">.imposter INDEX TABLE  Create imposter table TABLE on index INDEX</span><br><span class="line">.indexes ?TABLE?       Show names of all indexes</span><br><span class="line">                         If TABLE specified, only show indexes for tables</span><br><span class="line">                         matching LIKE pattern TABLE.</span><br><span class="line">.limit ?LIMIT? ?VAL?   Display or change the value of an SQLITE_LIMIT</span><br><span class="line">.log FILE|off          Turn logging on or off.  FILE can be stderr/stdout</span><br><span class="line">.mode MODE ?TABLE?     Set output mode where MODE is one of:</span><br><span class="line">                         ascii    Columns/rows delimited by 0x1F and 0x1E</span><br><span class="line">                         csv      Comma-separated values</span><br><span class="line">                         column   Left-aligned columns.  (See .width)</span><br><span class="line">                         html     HTML &lt;table&gt; code</span><br><span class="line">                         insert   SQL insert statements for TABLE</span><br><span class="line">                         line     One value per line</span><br><span class="line">                         list     Values delimited by .separator strings</span><br><span class="line">                         quote    Escape answers as for SQL</span><br><span class="line">                         tabs     Tab-separated values</span><br><span class="line">                         tcl      TCL list elements</span><br><span class="line">.nullvalue STRING      Use STRING in place of NULL values</span><br><span class="line">.once FILENAME         Output for the next SQL command only to FILENAME</span><br><span class="line">.open ?--new? ?FILE?   Close existing database and reopen FILE</span><br><span class="line">                         The --new starts with an empty file</span><br><span class="line">.output ?FILENAME?     Send output to FILENAME or stdout</span><br><span class="line">.print STRING...       Print literal STRING</span><br><span class="line">.prompt MAIN CONTINUE  Replace the standard prompts</span><br><span class="line">.quit                  Exit this program</span><br><span class="line">.read FILENAME         Execute SQL in FILENAME</span><br><span class="line">.restore ?DB? FILE     Restore content of DB (default &quot;main&quot;) from FILE</span><br><span class="line">.save FILE             Write in-memory database into FILE</span><br><span class="line">.scanstats on|off      Turn sqlite3_stmt_scanstatus() metrics on or off</span><br><span class="line">.schema ?PATTERN?      Show the CREATE statements matching PATTERN</span><br><span class="line">                          Add --indent for pretty-printing</span><br><span class="line">.separator COL ?ROW?   Change the column separator and optionally the row</span><br><span class="line">                         separator for both the output mode and .import</span><br><span class="line">.shell CMD ARGS...     Run CMD ARGS... in a system shell</span><br><span class="line">.show                  Show the current values for various settings</span><br><span class="line">.stats ?on|off?        Show stats or turn stats on or off</span><br><span class="line">.system CMD ARGS...    Run CMD ARGS... in a system shell</span><br><span class="line">.tables ?TABLE?        List names of tables</span><br><span class="line">                         If TABLE specified, only list tables matching</span><br><span class="line">                         LIKE pattern TABLE.</span><br><span class="line">.testcase NAME         Begin redirecting output to &#x27;testcase-out.txt&#x27;</span><br><span class="line">.timeout MS            Try opening locked tables for MS milliseconds</span><br><span class="line">.timer on|off          Turn SQL timer on or off</span><br><span class="line">.trace FILE|off        Output each SQL statement as it is run</span><br><span class="line">.vfsinfo ?AUX?         Information about the top-level VFS</span><br><span class="line">.vfslist               List all available VFSes</span><br><span class="line">.vfsname ?AUX?         Print the name of the VFS stack</span><br><span class="line">.width NUM1 NUM2 ...   Set column widths for &quot;column&quot; mode</span><br><span class="line">                         Negative values right-justify</span><br></pre></td></tr></table></figure>

<p>还是蛮多的, 不过常用的其实也就那些 我们来看一下, 关于输出(包括输出到标准输出的, 以及文件的)的:</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.backup ?DB? FILE</td>
<td>备份 DB 数据库（默认是 “main”）到 FILE 文件</td>
</tr>
<tr>
<td>.dump ?TABLE?</td>
<td>以 SQL 文本格式转储数据库。如果指定了 TABLE 表，则只转储匹配 LIKE 模式的 TABLE 表</td>
</tr>
<tr>
<td>.header(s) ON OFF</td>
<td>开启或关闭头部显示。</td>
</tr>
<tr>
<td>.mode MODE</td>
<td>设置输出模式，MODE包括: ascii column csv html insert line list tabs tcl</td>
</tr>
<tr>
<td>.output FILENAME</td>
<td>发送输出到 FILENAME</td>
</tr>
<tr>
<td>.timer ON OFF</td>
<td>开启或者关闭定时器</td>
</tr>
<tr>
<td>.width NUM NUM</td>
<td>为column模式设置宽度.</td>
</tr>
<tr>
<td>.save FILENAME</td>
<td>将内存中的数据写入到文件( 其实还是.backup )</td>
</tr>
</tbody></table>
<p>接着是一些打开, 导入导出和列出类的:</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.databases</td>
<td>列出数据库的名称及其所依附的文件</td>
</tr>
<tr>
<td>.import FILE TABLE</td>
<td>导入来自 FILE 文件的数据到 TABLE 表中</td>
</tr>
<tr>
<td>.indices ?TABLE?</td>
<td>显示所有索引的名称。如果指定了 TABLE 表，则只显示匹配 LIKE 模式的 TABLE 表的索引</td>
</tr>
<tr>
<td>.schema ?TABLE?</td>
<td>显示 CREATE 语句。如果指定了 TABLE 表，则只显示匹配 LIKE 模式的 TABLE 表。</td>
</tr>
<tr>
<td>.read FILENAME</td>
<td>执行 FILENAME 文件中的 SQL.</td>
</tr>
<tr>
<td>.open</td>
<td>打开一个数据库文件</td>
</tr>
<tr>
<td>.tables ?PATTERN?</td>
<td>列出匹配 LIKE 模式的表的名称</td>
</tr>
</tbody></table>
<p>退出可以使用<code>.quit</code>也可以使用<code>.exit</code>.</p>
<h3 id="数据库-x3D-文件"><a href="#数据库-x3D-文件" class="headerlink" title="数据库 &#x3D; 文件"></a>数据库 &#x3D; 文件</h3><p>由于SQLite不同于其他的关系型数据库, 它使用一个文件映射一个数据库的设计, 这就使得库级别的操作显得和其他的有点不一样.</p>
<p>例如, 创建数据库 其实就是打开文件, 而逻辑层面的数据库和物理层面的文件之间的连接就显得很重要了. 我们可以看到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .da</span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  --------------------------</span><br><span class="line">0    main             /private/tmp/testdb</span><br></pre></td></tr></table></figure>

<p>这里main数据库就和对应的文件进行了连接. 对于SQLite来说, 数据库级别的操作, 最主要的就是这两个:</p>
<ul>
<li>ATTACH</li>
<li>DETACH</li>
</ul>
<p>我们刚刚说过了, 最重要的东西是<strong>连接</strong>, 那么就不存在删除数据库的操作了(因为就是一个文件, 实在不行你把文件删除就行了). </p>
<p>下面我们就来看看这两个数据库操作: </p>
<p><strong>附加</strong> </p>
<p>附加就是一个建立连接的过程, 我们可以再把已经建立连接的文件再和一个数据库进行连接, 也可以开新的文件.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; attach testdb as &quot;test&quot;;</span><br><span class="line">sqlite&gt; .databases</span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /private/tmp/testdb</span><br><span class="line">2    test             /private/tmp/testdb</span><br></pre></td></tr></table></figure>

<p>但是main和temp数据库是不可以附加上去的, 因为他们已经在使用, 不仅如此, 你也不能分离他们.</p>
<p>如果是附加一个已经存在的数据库文件的话, 就相当于是添加了一个别名的感觉.</p>
<p><strong>分离</strong></p>
<p>所谓分离其实就是结束掉连接: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .databases</span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /private/tmp/testdb</span><br><span class="line">2    test             /private/tmp/testdb</span><br><span class="line">sqlite&gt; detach test;</span><br><span class="line">sqlite&gt; .data</span><br><span class="line">seq  name             file</span><br><span class="line">---  ---------------  ----------------------------------------------------------</span><br><span class="line">0    main             /private/tmp/testdb</span><br></pre></td></tr></table></figure>

<p>其实使用起来还是蛮简单的, 主要就是数据库变成了文件这一点一开始可能会有一点不适应.</p>
<h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><p>再说到表操作之前, 我们先来说说SQLite中的数据类型.</p>
<h3 id="SQLite中的数据类型"><a href="#SQLite中的数据类型" class="headerlink" title="SQLite中的数据类型"></a>SQLite中的数据类型</h3><p>和其他很多的关系数据库不同, SQLite使用一个更加动态的数据类型系统, 一个数据使用多少空间和他本身的值相关, 而和容器的关系不大. SQLite一共提供了5中数据存储类:</p>
<ul>
<li>NULL: 就是一个NULL值</li>
<li>INTEGER: 一个带符号的整数, 根据值的大小可能是1, 2, 3, 4, 6, 8个字节的存储容量</li>
<li>REAL: 浮点型, 8字节的IEEE浮点数字</li>
<li>TEXT: 文本字符, 编码方式取决于数据库的编码(UTF-8, UTF-16BE 或者 UTF-16LE) <em>关于编码的相关可以查看我之前的文章 — <a target="_blank" rel="noopener" href="https://yaoxuannn.com/2017/12/13/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0/">字符编码笔记</a></em></li>
<li>BLOB: 是一个blob数据, 根据输入存储</li>
</ul>
<p>这些存储类就是SQLite最终存储的数据类型了. 除了这些数据存储类, sqlite还有一个叫做亲和类的存储概念. SQLite会根据数据的值来进行转换, 主要有这些类型:</p>
<ul>
<li>TEXT</li>
<li>NUMERIC</li>
<li>INTEGER</li>
<li>REAL</li>
<li>NONE</li>
</ul>
<p>转换规则是这样的: </p>
<p>TEXT会将数值型的数据转换成是文本数据, 根据数据类型对对应的亲和类型(这个对应表我们会在后面补充), SQLite引擎会进行相应的转换. 如果是NUMERIC, 那么SQLite就会尝试在不丢失信息的情况下将文本数据转换成为INTEGER或者REAL类型, 而INTEGER和REAL类型和NUMERIC的规则是一致的, 不同之处在于INTEGER在执行CAST表达式的时候有不同以及在REAL在转换的时候不会将”100.00”转换成为100. 如果是NONE就不做任何转换.</p>
<p>文本没有代码好懂啊…来转换一下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TEXT: int -&gt; string</span><br><span class="line">NUMERIC: try &#123; string -&gt; integer/real &#125; except &#123; keep(string) &#125;</span><br><span class="line">NONE: None</span><br><span class="line">INTEGER: NUMERIC_INTEGER()</span><br><span class="line">REAL: NUMERIC_REAL()</span><br></pre></td></tr></table></figure>

<p>那么到底哪些类型的亲和类型是什么呢 我们来看这个表:</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>亲和类型</th>
</tr>
</thead>
<tbody><tr>
<td>INT  INTEGER  TINYINT  SMALLINT  MEDIUMINT  BIGINT  UNSIGNED BIG  INT  INT2  INT8</td>
<td>INTEGER</td>
</tr>
<tr>
<td>CHARACTER(20)  VARCHAR(255)  VARYING CHARACTER(255)  NCHAR(55)  NATIVE CHARACTER(70)  NVARCHAR(100)  TEXT  BLOB</td>
<td>TEXT</td>
</tr>
<tr>
<td>BLOB 或者是  (不指定)</td>
<td>NONE</td>
</tr>
<tr>
<td>REAL DOUBLE  DOUBLE PRECISION  FLOAT</td>
<td>REAL</td>
</tr>
<tr>
<td>NUMERIC  DECIMAL(10,5)  BOOLEAN  DATE  DATETIME</td>
<td>NUMERIC</td>
</tr>
</tbody></table>
<p>举个小栗子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table type (</span><br><span class="line">   ...&gt; id int,</span><br><span class="line">   ...&gt; name int</span><br><span class="line">   ...&gt; );</span><br><span class="line">sqlite&gt; insert into type values(&quot;jus&quot;, &quot;jus&quot;);</span><br><span class="line"># 没有报错</span><br><span class="line">sqlite&gt; select * from type;</span><br><span class="line">id          name</span><br><span class="line">----------  ----------</span><br><span class="line">jus         jus</span><br><span class="line"># 这根本就不是INT!!!</span><br></pre></td></tr></table></figure>

<p>这里我们的SQLite在尝试转换成INTEGER或者REAL的过程中失败了, 所以就变成了TEXT存储类了.</p>
<p>这就是说 我们所制定的类型可能并不会按照按照制定的所存储, 这就要求我们在插入表的时候要仔细的过滤数据了.</p>
<p>简单了解之后我们就可以开始尝试表级别的操作了.</p>
<h3 id="创建-删除"><a href="#创建-删除" class="headerlink" title="创建 删除"></a>创建 删除</h3><p>创建表的语法基本和你了解到的是一个样子的, 也没什么好说的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table if not exists student(</span><br><span class="line">   ...&gt; id int primary key not null,</span><br><span class="line">   ...&gt; name text not null,</span><br><span class="line">   ...&gt; age int not null,</span><br><span class="line">   ...&gt; active int(1) not null</span><br><span class="line">   ...&gt; );</span><br><span class="line">sqlite&gt; .schema student</span><br><span class="line">CREATE TABLE student(</span><br><span class="line">id int primary key not null,</span><br><span class="line">name text not null,</span><br><span class="line">age int not null,</span><br><span class="line">active int(1) not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>使用<code>.schema</code>命令来查看表的结构.</p>
<p>删除表的话, 就直接drop掉就可以了. 但是我们如果想要保留表结构只是清空数据的话, 在MySQL中是使用的<code>truncate</code>, 但是在SQLite中, 是没有这个的实现的. 如果想只清空数据的话, 就还是只能使用<code>delete</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; delete from TABLE;</span><br></pre></td></tr></table></figure>

<p>另外, 当我们需要修改已经常见的表的时候, 在SQLite中是不能修改已经存在的表结构的, 你只可以进行名称修改和添加:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; alter table test rename to testdb;</span><br><span class="line">sqlite&gt; alter table testdb add column age int not null default 0;</span><br></pre></td></tr></table></figure>

<h3 id="插入-查找-修改-删除"><a href="#插入-查找-修改-删除" class="headerlink" title="插入 查找 修改 删除"></a>插入 查找 修改 删除</h3><p>插入, 查找, 修改和删除的语法基本符合通常的SQL语句语法, 故不再赘述. 但是在这一部分我们补充下面两个小技巧: 我们知道一些命令只能在sqlite提示符中使用, 如果是在编程环境中怎么或者例如<code>.schema</code>的结果呢?</p>
<p>事实上, 在sqlite中维护着一个叫做<code>sqlite_master</code>的表, 这个表中涵盖了当前数据库中的索引, 表的信息.</p>
<p>来看一下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .mode csv</span><br><span class="line">sqlite&gt; select * from sqlite_master;</span><br><span class="line">type,name,tbl_name,rootpage,sql</span><br><span class="line">table,student,student,4,&quot;CREATE TABLE student(</span><br><span class="line">id int primary key not null,</span><br><span class="line">name text not null,</span><br><span class="line">age int not null,</span><br><span class="line">active int(1) not null</span><br><span class="line">)&quot;</span><br><span class="line">index,sqlite_autoindex_student_1,student,5,</span><br><span class="line">table,testdb,testdb,2,&quot;CREATE TABLE &quot;&quot;testdb&quot;&quot; (</span><br><span class="line">id integer primary key autoincrement not null,</span><br><span class="line">name text not null</span><br><span class="line">, age int not null default 0)&quot;</span><br><span class="line">table,sqlite_sequence,sqlite_sequence,3,&quot;CREATE TABLE sqlite_sequence(name,seq)&quot;</span><br></pre></td></tr></table></figure>

<p>这就是说, 我们在以后想要获得表的结构的话, 通过在这个表中进行查找操作就可以了.</p>
<p>另外, 在上面的这个表中我们看到了一个叫做<code>sqlite_seq</code>的表, 当你启动了<code>autoincrement</code>的时候, 这个表就会被自动创建然后记录当前这个递增的大小, 这也就是说你是可以通过操作这个表的数据值来控制自增量的.</p>
<p>假设我们的表中数据LIKE THIS:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from test;</span><br><span class="line">id          name        age</span><br><span class="line">----------  ----------  ----------</span><br><span class="line">1           Justin      20</span><br><span class="line">2           Selena      23</span><br><span class="line">3           Selena      21</span><br></pre></td></tr></table></figure>

<p>有两个重复记录, 那么这个时候我们可以使用**<code>distinct</code>**关键字, 来进行去重:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select distinct name from test;</span><br><span class="line">name</span><br><span class="line">----------</span><br><span class="line">Justin</span><br><span class="line">Selena</span><br></pre></td></tr></table></figure>

<h3 id="子句"><a href="#子句" class="headerlink" title="子句"></a>子句</h3><p>SQLite的子句包括下面这些:</p>
<ul>
<li>WHERE子句</li>
<li>LIKE子句</li>
<li>GLOB子句</li>
<li>LIMIT子句</li>
<li>ORDER BY子句</li>
<li>GROUP BY子句</li>
<li>HAVING子句</li>
</ul>
<p>其中我们只说一下GLOB子句, 其他的都和基础SQL一样的使用.</p>
<p>GLOB说来也很简单, 基本上和LIKE子句一样的使用方法, 不同的是, 通配符变成了遵循UNIX规范的<code>*</code>和<code>?</code>来分别表示<code>%</code>和<code>_</code>, 也就是0,1或者多个数字或者字符以及单一的数字或者字符.</p>
<h3 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h3><p>SQLite同样可以使用子查询, 连接和合并</p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>索引是为了更快的检索数据的特殊的表. 创建索引语法是这样的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name ON table_name;</span><br></pre></td></tr></table></figure>

<p>但是如果你的表太小或者是一个需要频繁更新和插入的表的话就不建议使用索引了, 因为这样反而会使得它降低性能.</p>
<p>我们向student表中插入了10000条数据来检测索引带来的性能提升:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select id from student order by id desc limit 1;</span><br><span class="line">id</span><br><span class="line">----------</span><br><span class="line">10001</span><br><span class="line">sqlite&gt; .timer on</span><br><span class="line">sqlite&gt; select * from student where name = &quot;James Frost&quot;;</span><br><span class="line">id          name                  age         gender      active</span><br><span class="line">----------  --------------------  ----------  ----------  ----------</span><br><span class="line">5020        James Frost           16          1           1</span><br><span class="line">Run Time: real 0.001 user 0.000907 sys 0.000081</span><br><span class="line">sqlite&gt; .timer off</span><br><span class="line">sqlite&gt; create index student_index on student(name);</span><br><span class="line">sqlite&gt; .timer on</span><br><span class="line">sqlite&gt; select * from student (indexed by student_index) where name = &quot;James Frost&quot;;</span><br><span class="line">id          name                  age         gender      active</span><br><span class="line">----------  --------------------  ----------  ----------  ----------</span><br><span class="line">5020        James Frost           16          1           1</span><br><span class="line">Run Time: real 0.000 user 0.000094 sys 0.000051</span><br></pre></td></tr></table></figure>

<p>可以看出来性能确实是有个不小的提升. 可以在查询语句中加入<code>indexed by</code>来说明使用哪一个索引来进行查询.</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>同样我们之前就说过SQLite是符合ACID的, 所以自然是支持事务的, 控制事务的三个语句:</p>
<ul>
<li>BEGIN TRANSACTION(BEGIN)</li>
<li>ROLLBACK</li>
<li>COMMIT(END TRANSACTION)</li>
</ul>
<h2 id="Python的SQLITE库"><a href="#Python的SQLITE库" class="headerlink" title="Python的SQLITE库"></a>Python的SQLITE库</h2><p>Python的sqlite库是从Python2.5之后的版本就有了, 在整套API中, 我们主要关注的就是两个对象: Connection和Cursor.</p>
<h3 id="模块-sqlite3"><a href="#模块-sqlite3" class="headerlink" title="模块 sqlite3"></a>模块 sqlite3</h3><p>首先, 我们还是从模块入手, sqlite3模块提供的使用率最高的方法就是<code>connect</code>, 其实这个方法就是返回一个Connection对象, 通过在这个方法中传递参数来控制一些连接的全局属性, 例如: 是否开启自动commit模式, 是否使用url进行连接, 连接超时时长等等.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">db = sqlite3.connect(<span class="string">&#x27;file:path/to/database?mode=ro&#x27;</span>, uri=<span class="literal">True</span>, isolation_level=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>这样就可以指明文件路径, 如果想要在<strong>内存</strong>中进行写入操作的话, 打开<code>:memory:</code>就可以了. 另外Connection对象有一个控制事务的属性是一个叫做隔离等级的属性: <code>isolation_level</code>, 当他设置成为None的时候就表明是自动提交的模式, 其余都需要使用者手动的执行commit操作. 默认情况下, 在执行一个DML语句的时候就会默认打开一个事务.</p>
<p>另外, 在3.6之后的版本 之后可以通过访问Connection的只读bool属性<code>in_transaction</code>来获得当前的事务状态.</p>
<p>接下里我们还要说一下Python中的数据类型和SQLite中的数据类型的互相转化:</p>
<table>
<thead>
<tr>
<th>Python type</th>
<th>SQLite type</th>
</tr>
</thead>
<tbody><tr>
<td><code>None</code></td>
<td><code>NULL</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>INTEGER</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>REAL</code></td>
</tr>
<tr>
<td><code>str</code></td>
<td><code>TEXT</code></td>
</tr>
<tr>
<td><code>bytes</code></td>
<td><code>BLOB</code></td>
</tr>
</tbody></table>
<p>如果是从SQLite到Python是这样的:</p>
<table>
<thead>
<tr>
<th>SQLite type</th>
<th>Python type</th>
</tr>
</thead>
<tbody><tr>
<td><code>NULL</code></td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>INTEGER</code></td>
<td><code>int</code></td>
</tr>
<tr>
<td><code>REAL</code></td>
<td><code>float</code></td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>depends on <code>text_factory</code>, <code>str</code> by default</td>
</tr>
<tr>
<td><code>BLOB</code></td>
<td><code>bytes</code></td>
</tr>
</tbody></table>
<h3 id="类-Connection"><a href="#类-Connection" class="headerlink" title="类 Connection"></a>类 Connection</h3><p>除了上面提到的几个属性, Connection还可以使用<code>total_changes</code>来获得从连接打开到调用为止被操作的总行数. 回到上面说的事务, 事务管理的任务都在Connection这对象身上, 通过下面两个(基本和SQL保持一致的):</p>
<ul>
<li>commit()</li>
<li>rollback()</li>
</ul>
<p>而当不需要使用的时候别忘记关闭连接, 使用<code>close()</code>, 如果在非自动提交的模式下使用了close()而没有commit的, 之前的修改会丢失的, 这点要注意.</p>
<p>通过这个Connection对象 我们还可以获得当前数据库的dump信息, 直接使用connection.iterdump方法就可以返回一个迭代器, 通过迭代就可以获得在shell中使用<code>.dump</code>一样的原始SQL信息.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">con = sqlite3.connect(<span class="string">&#x27;existing_db.db&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dump.sql&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> con.iterdump():</span><br><span class="line">        f.write(<span class="string">&#x27;%s\n&#x27;</span> % line)</span><br></pre></td></tr></table></figure>

<p>和数据库交互的总重要的一步就是进行SQL语句的执行了.</p>
<p>我们可以直接使用Connection对象执行 但是这实际上调用的还是下面说的Cursor对象的执行方法, (官方文档是这么说的: 不标准的快捷方式 - nonstandard shortcut )和其他很多DBAPI一样, 包含着这些:</p>
<ul>
<li>execute: 执行一个SQL语句, 可以使用占位符(包括?形式和:name命名形式)</li>
<li>executemany: 执行几个相同但是参数不一样的SQL语句, 通过传递生成器来进行迭代的执行</li>
<li>executescript: 直接像在执行rawSQL一样, 传递SQL脚本, 直接执行多条SQL语句</li>
</ul>
<p>代码表示我们在后面的Cursor对象中再说.</p>
<p>那么怎么拿到一个Cursor对象, 就使用Connection的cursor方法就可以了.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cur = conn.cursor()</span><br></pre></td></tr></table></figure>

<h3 id="类-Cursor"><a href="#类-Cursor" class="headerlink" title="类 Cursor"></a>类 Cursor</h3><p>Cursor对象无非就是做两个事情, 执行SQL和取得结果集. 先来看看Connection真正调用的三个执行方法是怎么样的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">con = sqlite3.connect(<span class="string">&quot;:memory:&quot;</span>)</span><br><span class="line">cur = con.cursor()</span><br><span class="line">cur.execute(<span class="string">&quot;create table people (name_last, age)&quot;</span>)</span><br><span class="line"></span><br><span class="line">who = <span class="string">&quot;Yeltsin&quot;</span></span><br><span class="line">age = <span class="number">72</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the qmark style:</span></span><br><span class="line">cur.execute(<span class="string">&quot;insert into people values (?, ?)&quot;</span>, (who, age))</span><br><span class="line"></span><br><span class="line"><span class="comment"># And this is the named style:</span></span><br><span class="line">cur.execute(<span class="string">&quot;select * from people where name_last=:who and age=:age&quot;</span>, &#123;<span class="string">&quot;who&quot;</span>: who, <span class="string">&quot;age&quot;</span>: age&#125;)</span><br></pre></td></tr></table></figure>

<p>而execute方法只可以执行单独的一条SQL语句. 假设一个场景是需要插入多条数据, 那么我们就可以考虑使用excutemany这个函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">char_generator</span>():</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">        <span class="keyword">yield</span> (c,)</span><br><span class="line"></span><br><span class="line">con = sqlite3.connect(<span class="string">&quot;:memory:&quot;</span>)</span><br><span class="line">cur = con.cursor()</span><br><span class="line">cur.execute(<span class="string">&quot;create table characters(c)&quot;</span>)</span><br><span class="line"></span><br><span class="line">cur.executemany(<span class="string">&quot;insert into characters(c) values (?)&quot;</span>, char_generator())</span><br></pre></td></tr></table></figure>

<p>最后一种执行方法, 就是直接将sql脚本传入的形式, 文档依然将这种声明成是不标准的简便方式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">con = sqlite3.connect(<span class="string">&quot;:memory:&quot;</span>)</span><br><span class="line">cur = con.cursor()</span><br><span class="line">cur.executescript(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    create table person(</span></span><br><span class="line"><span class="string">        firstname,</span></span><br><span class="line"><span class="string">        lastname,</span></span><br><span class="line"><span class="string">        age</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    create table book(</span></span><br><span class="line"><span class="string">        title,</span></span><br><span class="line"><span class="string">        author,</span></span><br><span class="line"><span class="string">        published</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    insert into book(title, author, published)</span></span><br><span class="line"><span class="string">    values (</span></span><br><span class="line"><span class="string">        &#x27;Dirk Gently&#x27;&#x27;s Holistic Detective Agency&#x27;,</span></span><br><span class="line"><span class="string">        &#x27;Douglas Adams&#x27;,</span></span><br><span class="line"><span class="string">        1987</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>那么, 好了 现在我能够像数据库传递SQL了, 那么获取结果呢, 同样也有三种方式:</p>
<ul>
<li>fetchone: 获取一个结果(一个row), 如果没有结果了就会返回None</li>
<li>fetchmany: 抓取size个结果, size的大小取决于调用时传递的参数, 或者是cursor对象的<code>arraysize</code>属性, 如果没有数据就返回一个空的列表</li>
<li>fetchall: 获取所有的结果集</li>
</ul>
<p>再说一下Cursor的关闭问题, 关闭的好处在于: 释放资源, 将这个游标标记成是不可用的, 这样当我们尝试使用的时候就可以通过错误捕获来增强程序的健壮性. 反正就是关闭了吧.</p>
<p>之前说了可以听过cursor对象的arraysize属性来设置抓取的数量(虽然我觉得修改这个值并不如在fetchmany的参数中传递更好), 那么Cursor对象还有那些属性呢?</p>
<ul>
<li>rowcount<ul>
<li>这个属性尽管sqlite3模块有实现, 但是在原生的数据库中却没有很好的实现, 导致这个值的获取变得奇奇怪怪的 在3.6.5的版本前, 如果执行了<code>DELECT from table</code>这样的不带条件的 rowcount就会被设置成0</li>
</ul>
</li>
<li>lastrowid<ul>
<li>只读属性, 返回最后操作的行的rowid, 只有在执行了INSERT和REPLACE并且是使用的execute函数才会被设置, 并且对REPLACE的支持实在3.6的版本中加入的.</li>
</ul>
</li>
<li>connection<ul>
<li>就是返回拿到这个cursor的connection是哪一个connection</li>
</ul>
</li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">Tags</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLite"><span class="toc-number">1.</span> <span class="toc-text">SQLite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLite%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.</span> <span class="toc-text">SQLite的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-x3D-%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">数据库 &#x3D; 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">1.3.</span> <span class="toc-text">表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLite%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">SQLite中的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-%E5%88%A0%E9%99%A4"><span class="toc-number">1.5.</span> <span class="toc-text">创建 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5-%E6%9F%A5%E6%89%BE-%E4%BF%AE%E6%94%B9-%E5%88%A0%E9%99%A4"><span class="toc-number">1.6.</span> <span class="toc-text">插入 查找 修改 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%8F%A5"><span class="toc-number">1.7.</span> <span class="toc-text">子句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.8.</span> <span class="toc-text">高级查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.9.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.10.</span> <span class="toc-text">事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E7%9A%84SQLITE%E5%BA%93"><span class="toc-number">2.</span> <span class="toc-text">Python的SQLITE库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97-sqlite3"><span class="toc-number">2.1.</span> <span class="toc-text">模块 sqlite3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB-Connection"><span class="toc-number">2.2.</span> <span class="toc-text">类 Connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB-Cursor"><span class="toc-number">2.3.</span> <span class="toc-text">类 Cursor</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&text=SQLite3与Python3"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&is_video=false&description=SQLite3与Python3"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SQLite3与Python3&body=Check out this article: https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&title=SQLite3与Python3"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&name=SQLite3与Python3&description=&lt;p&gt;SQLite是一个使用C语言编写的体积超小的嵌入式数据库, 一个数据库就是一个文件. 由于体积小并且迅速, 所以SQLite经常被嵌入到一些iOS或者Android的应用程序中. 这不, 在Python3的标准库中就嵌入了一个SQLite.&lt;/p&gt;
&lt;p&gt;接下来我们就来说说这个小家伙以及怎么使用Python3的SQLite的标准库.&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://19971122.xyz/2017/12/18/SQLite3%E4%B8%8EPython3/&t=SQLite3与Python3"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    Yaoxuan Wei
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'yaoxuannn-com';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
