<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="自动化运维第一步, 走起.">
<meta property="og:type" content="article">
<meta property="og:title" content="自动化运维之Ansible">
<meta property="og:url" content="https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/index.html">
<meta property="og:site_name" content="Yaoxuannn&#39;s Blog">
<meta property="og:description" content="自动化运维第一步, 走起.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1508910970&di=b03f6498f57d1acb911248e9d8ddd53e&src=http://s2.51cto.com/wyfs02/M02/79/79/wKiom1aSQHHjJRZTAAEBRfKpi_E196.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook2.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook3.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook4.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook6.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook7.png">
<meta property="og:image" content="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook8.png">
<meta property="article:published_time" content="2017-10-25T16:31:53.000Z">
<meta property="article:modified_time" content="2020-11-30T01:50:57.000Z">
<meta property="article:author" content="Yaoxuan Wei">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Ansible">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1508910970&di=b03f6498f57d1acb911248e9d8ddd53e&src=http://s2.51cto.com/wyfs02/M02/79/79/wKiom1aSQHHjJRZTAAEBRfKpi_E196.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>自动化运维之Ansible</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-09NWQ40K0B"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-09NWQ40K0B');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/photography/">photography</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2017/10/28/Corosync-Pacemaker%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2017/10/23/SCSI%E5%92%8CiSCSI%E5%8D%8F%E8%AE%AE%E4%BB%A5%E5%8F%8ALinux-IP-SAN%E7%9A%84%E5%AE%9E%E7%8E%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&text=自动化运维之Ansible"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&is_video=false&description=自动化运维之Ansible"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=自动化运维之Ansible&body=Check out this article: https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&name=自动化运维之Ansible&description=&lt;p&gt;自动化运维第一步, 走起.&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&t=自动化运维之Ansible"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">自动化运维相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">Ansible入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron"><span class="toc-number">2.1.</span> <span class="toc-text">cron</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user"><span class="toc-number">2.2.</span> <span class="toc-text">user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group"><span class="toc-number">2.3.</span> <span class="toc-text">group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy"><span class="toc-number">2.4.</span> <span class="toc-text">copy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file"><span class="toc-number">2.5.</span> <span class="toc-text">file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping"><span class="toc-number">2.6.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service"><span class="toc-number">2.7.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell"><span class="toc-number">2.8.</span> <span class="toc-text">shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#script"><span class="toc-number">2.9.</span> <span class="toc-text">script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum"><span class="toc-number">2.10.</span> <span class="toc-text">yum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup"><span class="toc-number">2.11.</span> <span class="toc-text">setup</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML"><span class="toc-number">3.</span> <span class="toc-text">YAML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Playbook"><span class="toc-number">4.</span> <span class="toc-text">Playbook</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        自动化运维之Ansible
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Yaoxuan Wei</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-10-25T16:31:53.000Z" class="dt-published" itemprop="datePublished">2017-10-25</time>
        
        (Updated: <time datetime="2020-11-30T01:50:57.000Z" class="dt-updated" itemprop="dateModified">2020-11-29</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Ansible/" rel="tag">Ansible</a>, <a class="p-category" href="/tags/Linux/" rel="tag">Linux</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>自动化运维第一步, 走起.</p>
<span id="more"></span>

<p>由于这是第一篇学习自动化运维工具的文章, 所以我们先来瞎扯扯..</p>
<h2 id="自动化运维相关"><a href="#自动化运维相关" class="headerlink" title="自动化运维相关"></a>自动化运维相关</h2><p>我们的运维工作, 假设从系统的安装开始, 这里就已经有很多说的点了. 比如我们可以从设备厂商协调好, 安装指定版本的系统, 这样拿过来的机器就已经是有系统了. 另外, 还可以使用我们之前说的PXE技术进行网络引导, 只要接通电源开机就可以自动进行安装了. 这是物理机的情况. 如果是虚拟机就更简单了, 我们可以直接生成一个模板, 模板中都携带了需要配置的各个参数, 但是这个时候, 我们可能需要在安装的时候有工具能够动态的去插入一些私有的信息, 例如MAC地址. 接着安装完系统, 我们就进入程序包的安装, 配置和服务启动, 想象一个十几台机器的场景, 难道一个一个手动的配置? 显然不可能, 这里我们就需要有能够统一集中部署的方法, 也就是批量的操作. 再往后, 我们就需要进行服务的发布了, 这个一般就是比较重要的一环了, 我们需要进行平滑的, 滚动的更新和版本回滚. 再往后, 就是监控的工作. 例如:告警, 自动修复等等.</p>
<p>再说说我们的程序发布问题, 首先在程序的研发阶段完成了之后, 显然是需要进行测试的. 这一步叫做<strong>预发布验证</strong>, 新版本的代码先发布到测试环境中, 测试环境可能和线上的环境配置相同, 只不过没有接入调度器罢了. 在我们的程序发布中, 有一些原则性的问题需要保证:</p>
<ul>
<li>不能影响用户体验</li>
<li>系统不能停机</li>
<li>不能导致系统故障或者系统不可用</li>
</ul>
<p>这样我们就需要一个发布模型, 常见的一种叫做<strong>灰度模型, 灰度发布</strong>, 一般我们可以使用符号链接的方式进行版本间切换. 接着 按照我们说过的 只要路径相同, 或者说都是标准的. 我们就可以通过应用程序或者脚本进行自动的切换.</p>
<h2 id="Ansible入门"><a href="#Ansible入门" class="headerlink" title="Ansible入门"></a>Ansible入门</h2><p>现在就来说说主角了, Ansible是一个使用Python语言的自动化运维工具, 功能挺强大的. 不过不管怎么说, 先来想个这样的问题, 我们怎么在远端执行命令呢? 我们知道所有的操作都是需要用户的权限来执行的. 这个时候还记得之前在说keepalived和heartbeat的时候使用的:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh VM-node3 <span class="string">&quot;date&quot;</span></span><br></pre></td></tr></table></figure>

<p>吗?</p>
<p>是的, 我们的ansible就是使用ssh协议进行的远端调用. 这就说明, 我们只需要一个ansible服务端就行了, 被调用的, 或者说被管理的节点不需要特地安装其他的程序. 这就是<code>agentless</code>的运维工具.  而另外一种 就是<code>agent</code>的, 这就是运维工具的一个小分类. </p>
<p>除了ansible, fabric也是基于ssh的. 另外, puppet , func 这些就是典型的需要agent的类型了.</p>
<p>当然, 是否需要agent各有各的好处和缺点. </p>
<blockquote>
<p>截止目前(2017-10-25 13:51), Ansible的github仓库star数是26w, 3420个仍旧open的issue和1.1万个已经closed的.</p>
</blockquote>
<p>Ansible能够实现统一配置, 统一部署, 批量执行, 多层次多用户并行等功能. 来看一张架构图:</p>
<p><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b10000_10000&sec=1508910970&di=b03f6498f57d1acb911248e9d8ddd53e&src=http://s2.51cto.com/wyfs02/M02/79/79/wKiom1aSQHHjJRZTAAEBRfKpi_E196.png" alt="img"></p>
<p> 左上角的Host Inventory就是字面意思, 存放管理的主机清单. Ansible通过才能够下面定制的Playbooks从Inventory中抓取主机清单, 接着通过右上角的连接插件进行连接和管理操作. 而且还可以使用插件和其他语言建立自定义的模块.</p>
<p>Ansible依靠Python中的Paramiko, PyYAML, Jinja2等库和模块构建. </p>
<p>直接安装看看, ansible被收录在epel源中, 配置好yum源就可以直接yum install了.</p>
<p>安装完成后, 我们可以看到, 几个配置文件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># rpm -ql ansible | less</span></span><br><span class="line">/etc/ansible</span><br><span class="line">/etc/ansible/ansible.cfg</span><br><span class="line">/etc/ansible/hosts</span><br><span class="line">/etc/ansible/roles</span><br><span class="line">..(omitted)</span><br></pre></td></tr></table></figure>

<p>主配置文件就是那个cfg了, 额hosts就是我们的inventory.  但是这个清单文件也不是随随便便就可以写的, 里面要指明Web服务器, 存储服务器等等包括其他的一些信息.</p>
<p>由于使用ssh的方式, 所以不妨还是先把基于密钥的认证做一下, 当然这不是必须的, 我们也可以在配置文件中指明主机的账号和密码. 我已经配好了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ssh VM-node2 &#x27;date&#x27;</span></span><br><span class="line">Thu Oct 26 05:40:41 CST 2017</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ssh VM-node3 &#x27;date&#x27;</span></span><br><span class="line">Wed Oct 25 21:40:44 CST 2017</span><br></pre></td></tr></table></figure>

<p>接下来我们就来看一下ansible基本命令是怎么使用的吧.</p>
<p>ansible基于模块的设计, 所以我们使用ansible, 其实就是使用它的模块, ansible的默认模块是一个叫做<code>command</code>的模块. 总体的命令格式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;host-pattern&gt; [options]</span><br></pre></td></tr></table></figure>

<p>这里的host-pattern就是可以指定的主机, 默认使用的配置文件就是<code>/etc/ansible/hosts</code>, 我们先来看一下这个文件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[testservers]</span><br><span class="line">192.168.206.9</span><br><span class="line">192.168.206.10</span><br><span class="line">192.168.206.22</span><br><span class="line"><span class="comment">#####</span></span><br><span class="line">www[001:006].example.com</span><br></pre></td></tr></table></figure>

<p>通过这样的组定义, 我们可以一个服务器组, 也支持这样的, ansible可以自动展开.</p>
<p>定义了主机之后 ,我们就可以使用ansible了, 示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m command -a &quot;uname -r&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">2.6.32-220.el6.x86_64</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">3.10.0-693.2.2.el7.x86_64</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">3.10.0-693.2.2.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>来解释一下,  首先我们指明对哪些主机执行操作, 这里就使用的是当时在文件中定义的组名, 接着我们使用-m指明使用的模块command, 后面的参数就是对于每一个模块而言的了. 每一个模块有自己的参数.</p>
<p>那么我该怎么样获取每个模块的用法呢? ansible-doc就是为了这个存在的, 我们可以使用下面来查看所有的模块和每个模块的用法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible-doc -l</span></span><br><span class="line">a10_server                                Manage A10 Networks AX/SoftAX/Thunder/vThunder devices<span class="string">&#x27; server object.                                                      </span></span><br><span class="line"><span class="string">a10_server_axapi3                         Manage A10 Networks AX/SoftAX/Thunder/vThunder devices                                                                      </span></span><br><span class="line"><span class="string">a10_service_group                         Manage A10 Networks AX/SoftAX/Thunder/vThunder devices&#x27;</span> service <span class="built_in">groups</span>.                                                     </span><br><span class="line">a10_virtual_server                        Manage A10 Networks AX/SoftAX/Thunder/vThunder devices<span class="string">&#x27; virtual servers.                                                    </span></span><br><span class="line"><span class="string">accelerate                                Enable accelerated mode on remote node                                                                                      </span></span><br><span class="line"><span class="string">aci_aep                                   Manage attachable Access Entity Profile (AEP) on Cisco ACI fabrics (infra:AttEntityP)                                       </span></span><br><span class="line"><span class="string">aci_ap                                    Manage top level Application Profile (AP) objects on Cisco ACI fabrics (fv:Ap)                                              </span></span><br><span class="line"><span class="string">aci_bd                                    Manage Bridge Domains (BD) on Cisco ACI Fabrics (fv:BD)                                                                     </span></span><br><span class="line"><span class="string">aci_bd_subnet                             Manage Subnets on Cisco ACI fabrics (fv:Subnet)                                                                             </span></span><br><span class="line"><span class="string">aci_bd_to_l3out                           Bind Bridge Domain to L3 Out on Cisco ACI fabrics (fv:RsBDToOut)                                                            </span></span><br><span class="line"><span class="string">aci_config_rollback                       Provides rollback and rollback preview functionality for Cisco ACI fabrics (config:ImportP)                                 </span></span><br><span class="line"><span class="string">aci_config_snapshot                       Manage Config Snapshots on Cisco ACI fabrics (config:Snapshot, config:ExportP)                             </span></span><br><span class="line"><span class="string">...(omitted)</span></span><br></pre></td></tr></table></figure>

<p>太多了, 我们看看一共有多少的模块支持:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible-doc -l | wc -l</span></span><br><span class="line">1375</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible-doc command</span></span><br><span class="line">&gt; COMMAND    (/usr/lib/python2.7/site-packages/ansible/modules/commands/command.py)</span><br><span class="line"></span><br><span class="line">        The `<span class="built_in">command</span><span class="string">&#x27; module takes the command name followed by a list of space-delimited arguments. The given command will be executed</span></span><br><span class="line"><span class="string">        on all selected nodes. It will not be processed through the shell, so variables like `$HOME&#x27;</span> and operations like `<span class="string">&quot;&lt;&quot;</span><span class="string">&#x27;, `&quot;&gt;&quot;&#x27;</span>,</span><br><span class="line">        `<span class="string">&quot;|&quot;</span><span class="string">&#x27;, `&quot;;&quot;&#x27;</span> and `<span class="string">&quot;&amp;&quot;</span><span class="string">&#x27; will not work (use the [shell] module if you need these features). For Windows targets, use the</span></span><br><span class="line"><span class="string">        [win_command] module instead.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">OPTIONS (= is mandatory):</span></span><br><span class="line"><span class="string">...(omitted)</span></span><br></pre></td></tr></table></figure>

<p>1000+的模块, 但是我们使用的也是很有限的几个. 可以直接在后面加上模块的名字, 就可以获取到相关的说明和文档了.</p>
<p>另外, 由于command是默认模块, 所以也可以不用特定指明:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &quot;uname -r&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">2.6.32-220.el6.x86_64</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">3.10.0-693.2.2.el7.x86_64</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">3.10.0-693.2.2.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>使用all关键字, 就可以对整个文件中的主机发出指令.</p>
<p>接下来就来学习一下常见的几个模块吧.</p>
<h3 id="cron"><a href="#cron" class="headerlink" title="cron"></a>cron</h3><p>先来看一个示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m cron -a &quot;minute=*/10 job=&#x27;/bin/echo Hello&#x27; name=&#x27;test of Ansible cron module&#x27; state=present&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;test of Ansible cron module&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;test of Ansible cron module&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;test of Ansible cron module&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着我们来稍微确认一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -a &#x27;crontab -l&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line"><span class="comment">#Ansible: test of Ansible cron module</span></span><br><span class="line">*/10 * * * * /bin/echo Hello</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line"><span class="comment">#Ansible: test of Ansible cron module</span></span><br><span class="line">*/10 * * * * /bin/echo Hello</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line"><span class="comment">#Ansible: test of Ansible cron module</span></span><br><span class="line">*/10 * * * * /bin/echo Hello</span><br></pre></td></tr></table></figure>

<p>已经添加好了.</p>
<p>我们来说说一些相关的参数吧, 首先肯定要提供的就是我们的时间间隔和任务是什么, 对应minute, hour, day, weekday, 如果不指明就是默认的<code>*</code>. 接着我们需要指明添加的名字是什么, 这样Ansible才可以对他们进行操作. 如果不指定就是None, 这样造成的后果是很严重的, 相当于每一次操作就会改变全体. 接着最后我们写了一个state, 指明是添加还是去除, 默认是添加.</p>
<p>比如我们现在把之前添加的删除掉:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m cron -a &quot;name=&#x27;test of Ansible cron module&#x27; state=absent&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就没有了.</p>
<h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>user模块听名字也就知道功能是什么了吧哈哈. 对就是进行用户管理的, 有很多属性和指令, 必须要给的一个就是name用户名了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m user -a &#x27;name=user1&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 500, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 500</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1000, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1000</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1001, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1001</span><br><span class="line">&#125;</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m user -a &#x27;name=user1&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 500, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 500</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1000, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1000</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;createhome&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1001, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1001</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着我们也可以确认一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;tail -1 /etc/passwd&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:x:500:500::/home/user1:/bin/bash</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:x:1000:1000::/home/user1:/bin/bash</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:x:1001:1001::/home/user1:/bin/bash</span><br></pre></td></tr></table></figure>

<p>要删除也很简单了, 直接state&#x3D;absent就行了. 其他的功能通过读文档也能很快的OK.</p>
<h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><p>就好比我们的groupadd命令的参数极其的少一样, 这个模块也很简单:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible-doc -s group</span></span><br><span class="line">- name: Add or remove <span class="built_in">groups</span></span><br><span class="line">  group:</span><br><span class="line">      gid:                   <span class="comment"># Optional `GID&#x27; to set for the group.</span></span><br><span class="line">      name:                  <span class="comment"># (required) Name of the group to manage.</span></span><br><span class="line">      state:                 <span class="comment"># Whether the group should be present or not on the remote host.</span></span><br><span class="line">      system:                <span class="comment"># If `yes&#x27;, indicates that the group created is a system group.</span></span><br></pre></td></tr></table></figure>

<p>设置gid, 组名, 状态, 是否为系统组.完了. 就是这么简洁.</p>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><p>主要用来实现文件复制,  先来实际操作一次:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m copy -a &quot;src=/etc/fstab dest=/tmp/fstab.ansible owner=root mode=640&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;bcc5409249b05584582f46eb8cc41d6f93df01f8&quot;</span>, </span><br><span class="line">    <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/fstab.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;4fba41ce7527a0977db246e220f94855&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0640&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 465, </span><br><span class="line">    <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1509005226.85-229350602804565/source&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;bcc5409249b05584582f46eb8cc41d6f93df01f8&quot;</span>, </span><br><span class="line">    <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/fstab.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;4fba41ce7527a0977db246e220f94855&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0640&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;secontext&quot;</span>: <span class="string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 465, </span><br><span class="line">    <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1509005226.81-171401749560627/source&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;bcc5409249b05584582f46eb8cc41d6f93df01f8&quot;</span>, </span><br><span class="line">    <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/fstab.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;4fba41ce7527a0977db246e220f94855&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0640&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;secontext&quot;</span>: <span class="string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 465, </span><br><span class="line">    <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1509005226.8-44103016607587/source&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着简单的验证一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;ls -l /tmp/fstab.ansible&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">-rw-r----- 1 root root 465 Oct 26 16:07 /tmp/fstab.ansible</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">-rw-r-----. 1 root root 465 Oct 26 16:51 /tmp/fstab.ansible</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">-rw-r-----. 1 root root 465 Oct 26 16:07 /tmp/fstab.ansible</span><br></pre></td></tr></table></figure>

<p>确实也存在了.</p>
<p>其实我们会用到的参数也不是很多, 就那一些. 目的地址是必须要指明的,而且需要使用<strong>绝对地址</strong>. 另外, 对于目录, 如果出现了不存在的父目录, 会报错并执行失败.</p>
<p>使用owner&#x2F;group可以来指定属主属组, 接着mode用来指定权限, 都是很好理解的. 有意思的是, src并不是必须的. 我们也可以使用content来指明文件的内容, 例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m copy -a &#x27;content=&quot;Hello World\nHello Ansible\n&quot; dest=/tmp/test.ansible&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;checksum&quot;</span>: <span class="string">&quot;b9169ba8226473029923516a19a73c4c68f10daa&quot;</span>, </span><br><span class="line">    <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/test.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;md5sum&quot;</span>: <span class="string">&quot;0bb9e5050a1820c59d836bf9ef6a5080&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0644&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 26, </span><br><span class="line">    <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/root/.ansible/tmp/ansible-tmp-1509008122.2-242725231441981/source&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line">...(omitted)</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &quot;cat /tmp/test.ansible&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Hello World</span><br><span class="line">Hello Ansible</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Hello World</span><br><span class="line">Hello Ansible</span><br><span class="line"></span><br><span class="line">192.168.206.9 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Hello World</span><br><span class="line">Hello Ansible</span><br></pre></td></tr></table></figure>

<p>虽然, 该模块也可以提供对文件的操作, 但是更多的时候, 我们使用file模块</p>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>对于我们刚刚复制过去的那两个文件, 我们来修改一下属组属主, 修改一下权限, 并且来做个符号链接吧:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m file -a &#x27;owner=user1 group=user1 mode=600 path=/tmp/fstab.ansible&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 500, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0600&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;user1&quot;</span>, </span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/fstab.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 465, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;file&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 500</span><br><span class="line">&#125;</span><br><span class="line">...(omitted)</span><br></pre></td></tr></table></figure>

<p>还是..来验证一下吧:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;ls -l /tmp/fstab.ansible&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">-rw------- 1 user1 user1 465 Oct 26 16:07 /tmp/fstab.ansible</span><br><span class="line">...(omitted)</span><br></pre></td></tr></table></figure>

<p>接着, 我们在做一个符号链接指向它:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m file -a &#x27;path=/tmp/fstab.link src=/tmp/fstab.ansible state=link&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;dest&quot;</span>: <span class="string">&quot;/tmp/fstab.link&quot;</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;0777&quot;</span>, </span><br><span class="line">    <span class="string">&quot;owner&quot;</span>: <span class="string">&quot;root&quot;</span>, </span><br><span class="line">    <span class="string">&quot;size&quot;</span>: 18, </span><br><span class="line">    <span class="string">&quot;src&quot;</span>: <span class="string">&quot;/tmp/fstab.ansible&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;link&quot;</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 0</span><br><span class="line">&#125;</span><br><span class="line">...(omitted)</span><br></pre></td></tr></table></figure>

<p>也来…验证一下吧:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;ls -l /tmp/fstab.link&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">lrwxrwxrwx 1 root root 18 Oct 26 17:03 /tmp/fstab.link -&gt; /tmp/fstab.ansible</span><br><span class="line">...(omitted)</span><br></pre></td></tr></table></figure>

<p>注意在我们进行链接的时候要指明state&#x3D;link才行. 否则会报错的. 另外, 如果创建的是硬链接, 状态就是hard了.</p>
<h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><p>这是一个超级简单的模块哈哈, 这样用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m ping</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.206.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果主机可以ping通, 就会显示pong!</p>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>看名字就可以意识到这是一个超级重要的模块了吧哈哈. 我们来看一下吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -a &quot;service httpd status&quot;</span></span><br><span class="line"> [WARNING]: Consider using service module rather than running service</span><br><span class="line"></span><br><span class="line">192.168.206.22 | FAILED | rc=3 &gt;&gt;</span><br><span class="line">httpd is stoppednon-zero <span class="built_in">return</span> code</span><br><span class="line"></span><br><span class="line">192.168.206.10 | FAILED | rc=3 &gt;&gt;</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: man:httpd(8)</span><br><span class="line">           man:apachectl(8)</span><br><span class="line"></span><br><span class="line">Oct 25 03:50:01 VM-node2 systemd[1]: Unit httpd.service cannot be reloaded because it is inactive.Redirecting to /bin/systemctl status httpd.servicenon-zero <span class="built_in">return</span> code</span><br></pre></td></tr></table></figure>

<p>由于我们的后端两个主机不是一个系统, 这就造成输出的信息并不一致的情况了, 接着我们启动并且设置成开机自动启动httpd服务:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m service -a &#x27;enabled=true state=started name=httpd&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;httpd&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;started&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;httpd&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;started&quot;</span>, </span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ActiveEnterTimestampMonotonic&quot;</span>: <span class="string">&quot;0&quot;</span>, </span><br><span class="line">        <span class="string">&quot;ActiveExitTimestampMonotonic&quot;</span>: <span class="string">&quot;0&quot;</span>, </span><br><span class="line">        ...(omitted)</span><br><span class="line">        <span class="string">&quot;UnitFileState&quot;</span>: <span class="string">&quot;disabled&quot;</span>, </span><br><span class="line">        <span class="string">&quot;Wants&quot;</span>: <span class="string">&quot;system.slice&quot;</span>, </span><br><span class="line">        <span class="string">&quot;WatchdogTimestampMonotonic&quot;</span>: <span class="string">&quot;0&quot;</span>, </span><br><span class="line">        <span class="string">&quot;WatchdogUSec&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>( CentOS7输出的信息真可怕…</p>
<p>接着我们确认一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -a &#x27;service httpd status&#x27;</span></span><br><span class="line"> [WARNING]: Consider using service module rather than running service</span><br><span class="line"></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">httpd (pid  14688) is running...</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Thu 2017-10-26 18:19:33 CST; 2min 48s ago</span><br><span class="line">     Docs: man:httpd(8)</span><br><span class="line">           man:apachectl(8)</span><br><span class="line"> Main PID: 9510 (httpd)</span><br><span class="line">   Status: <span class="string">&quot;Total requests: 0; Current requests/sec: 0; Current traffic:   0 B/sec&quot;</span></span><br><span class="line">   CGroup: /system.slice/httpd.service</span><br><span class="line">           ├─9510 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─9511 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─9513 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─9514 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─9516 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           └─9517 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line"></span><br><span class="line">Oct 26 18:19:33 VM-node2 systemd[1]: Starting The Apache HTTP Server...</span><br><span class="line">Oct 26 18:19:33 VM-node2 systemd[1]: Started The Apache HTTP Server.Redirecting to /bin/systemctl status httpd.service</span><br></pre></td></tr></table></figure>

<p>确实已经启动, 而且, 开机自启动也已经OK了.</p>
<p>总结一下 service模块通过enabled来决定是否开机自动启动, 取值true或者false. name: 服务名称. state: 状态(stopped, started, restarted)</p>
<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p>shell模块和command模块有点类似, 但是不同之处在于, command不提供变量支持.  我们来做个测试就知道了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m command -a &quot;tail -1 /etc/shadow&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:!!:17465:0:99999:7:::</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:!!:17465:0:99999:7:::</span><br><span class="line"></span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m command -a &quot;echo &#x27;password&#x27; | passwd --stdin user1&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">password | passwd --stdin user1</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">password | passwd --stdin user1</span><br><span class="line"></span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m command -a &quot;tail -1 /etc/shadow&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:!!:17465:0:99999:7:::</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:!!:17465:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>没有设置成功, 原因是我们使用了管道符. 接下来换做shell试试:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m shell -a &quot;echo &#x27;password&#x27; | passwd --stdin user1&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Changing password <span class="keyword">for</span> user user1.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Changing password <span class="keyword">for</span> user user1.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m command -a &quot;tail -1 /etc/shadow&quot;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:$6<span class="variable">$paTv</span>//V6<span class="variable">$UmwQlj0OinDI9RLkIcHUWFvQNHxZF9aacuH272zDaRyoKpn21jH568IVLEJv</span>.Q8ShxPrtie9CHdfEuiVFgOwl0:17465:0:99999:7:::</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">user1:$6<span class="variable">$3DO</span>.U5ry<span class="variable">$uAXVYHoNz7R5IfdksZZZMvcYLnlXYKuIHebpg65obLoTupzZZmbAFvY4soylGBwepad33v6QJ6sPqbduAwMUX</span>.:17465:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>提示语也是不一样的. 密码也成功的更新了.</p>
<p>shell虽然支持这样的, 但是如果是要执行脚本, 我们就需要下一个模块了</p>
<h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><p>script模块用于脚本执行, 比较坑的一个地方是, 它不支持绝对路径, 也就是说仅仅只有当你使用相对路径才接受:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># cat script </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test&quot;</span> &gt; /tmp/script.ansible</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># chmod  +x script</span></span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m script -a &#x27;script&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 192.168.206.22 closed.\r\n&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 192.168.206.10 closed.\r\n&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照惯例, 验证一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;cat /tmp/script.ansible&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Test</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">Test</span><br></pre></td></tr></table></figure>

<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3><p>见名知意啦, 为了yum安装软件包的一个模块, 使用起来也很简单:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m yum -a &#x27;name=zsh&#x27;</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Loaded plugins: </span></span><br><span class="line"><span class="string">        ...(omitted)</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">192.168.206.10 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="string">    &quot;</span>changed<span class="string">&quot;: true, </span></span><br><span class="line"><span class="string">    &quot;</span>failed<span class="string">&quot;: false, </span></span><br><span class="line"><span class="string">    &quot;</span>msg<span class="string">&quot;: &quot;</span><span class="string">&quot;, </span></span><br><span class="line"><span class="string">    &quot;</span>rc<span class="string">&quot;: 0, </span></span><br><span class="line"><span class="string">    &quot;</span>results<span class="string">&quot;: [</span></span><br><span class="line"><span class="string">		...(omitted)</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这样就安装完成了, 我们来验证一下咯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;rpm -q zsh&#x27;</span></span><br><span class="line"> [WARNING]: Consider using yum, dnf or zypper module rather than running rpm</span><br><span class="line"></span><br><span class="line">192.168.206.22 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">zsh-4.3.11-4.el6.centos.2.x86_64</span><br><span class="line"></span><br><span class="line">192.168.206.10 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">zsh-5.0.2-28.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>删除也是很简单的, 直接指明state&#x3D;absent就行了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m yum -a &#x27;name=zsh state=absent&#x27;</span></span><br><span class="line">192.168.206.10 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">    	...(omitted)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;results&quot;</span>: [</span><br><span class="line">		...(omitted)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -a &#x27;rpm -q zsh&#x27;</span></span><br><span class="line"> [WARNING]: Consider using yum, dnf or zypper module rather than running rpm</span><br><span class="line"></span><br><span class="line">192.168.206.22 | FAILED | rc=1 &gt;&gt;</span><br><span class="line">package zsh is not installednon-zero <span class="built_in">return</span> code</span><br><span class="line"></span><br><span class="line">192.168.206.10 | FAILED | rc=1 &gt;&gt;</span><br><span class="line">package zsh is not installednon-zero <span class="built_in">return</span> code</span><br></pre></td></tr></table></figure>

<p>这样就删除掉了.</p>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><p>这个模块可以用来获取主机的fact信息. 什么是fact呢? 为了能够管理各个主机, ansible会获取每一个主机的一些信息, 包括系统信息, 内核版本, IP地址, BIOS日期等等大量信息:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible all -m setup</span></span><br><span class="line">192.168.206.22 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ansible_all_ipv4_addresses&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;192.168.206.22&quot;</span></span><br><span class="line">        ], </span><br><span class="line">        <span class="string">&quot;ansible_all_ipv6_addresses&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;fe80::20c:29ff:feb0:b47f&quot;</span></span><br><span class="line">        ], </span><br><span class="line">        <span class="string">&quot;ansible_apparmor&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;status&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">        &#125;, </span><br><span class="line">        <span class="string">&quot;ansible_architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>, </span><br><span class="line">        <span class="string">&quot;ansible_bios_date&quot;</span>: <span class="string">&quot;07/02/2015&quot;</span>, </span><br><span class="line">        <span class="string">&quot;ansible_bios_version&quot;</span>: <span class="string">&quot;6.00&quot;</span>, </span><br><span class="line">        <span class="string">&quot;ansible_cmdline&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;KEYBOARDTYPE&quot;</span>: <span class="string">&quot;pc&quot;</span>, </span><br><span class="line">            <span class="string">&quot;KEYTABLE&quot;</span>: <span class="string">&quot;us&quot;</span>, </span><br><span class="line">            <span class="string">&quot;LANG&quot;</span>: <span class="string">&quot;en_US.UTF-8&quot;</span>, </span><br><span class="line">            <span class="string">&quot;SYSFONT&quot;</span>: <span class="string">&quot;latarcyrheb-sun16&quot;</span>, </span><br><span class="line">            <span class="string">&quot;quiet&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">...(omitted)			</span><br></pre></td></tr></table></figure>

<h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p>说了一些模块的使用, 接下来我们就可以开始尝试写一下playbook了. 但在此之前, 我们还是要了解一下playbook的格式 – YAML</p>
<p>如果你使用过hexo, 并且乐于配置的话. 相信对YAML挺熟悉的了.不过我们在说说这个东西吧.</p>
<blockquote>
<p>YAML也是一个递归缩写, 即YAML Ain’t Markup Language. </p>
</blockquote>
<p>YAML通过缩进和键值对来表示数据结构. 使用一个<code>-</code>来表示列表, 使用一个<code>:</code>来表示键值对, 一个示例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Justin</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">gender:</span> <span class="string">Male</span></span><br><span class="line"><span class="attr">attr:</span></span><br><span class="line">	<span class="attr">isAlive:</span> <span class="literal">True</span></span><br><span class="line">	<span class="attr">isHappy:</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">skills:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">Linux</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">Windows</span></span><br></pre></td></tr></table></figure>

<p>很简单了..</p>
<h2 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a>Playbook</h2><p>想要写一个playbook, 我们先要了解到playbook涉及到那些东西, 请看下面:</p>
<ul>
<li>Inventory</li>
<li>Modules</li>
<li>Playbooks<ul>
<li>Tasks</li>
<li>Variable</li>
<li>Templates</li>
<li>Handlers</li>
<li>Roles</li>
</ul>
</li>
</ul>
<p>我们一个一个说, 首先还是我们的Inventory. 这个时候用来定义主机的对不上面说过了, 现在来补充一下. </p>
<p>首先我们可以把几个节点放在一起构成一个组:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[webservers]</span><br><span class="line">192.168.207.100:8080</span><br><span class="line">192.168.207.200</span><br><span class="line">web1.justin.com</span><br><span class="line">web2.justin.com</span><br></pre></td></tr></table></figure>

<p>如果主机遵循相同的命名规范, 我们还可以简写:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[webservers]</span><br><span class="line">web[1:10].justin.com</span><br></pre></td></tr></table></figure>

<p>另外, 我们还可以在inventory中定义一些主机变量供playbook使用,这些变量仅仅属于这些主机.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[frontend]</span><br><span class="line">web1.scuec.com http_port=80 maxRequestPerChild=1000</span><br><span class="line">web2.scuec.com http_port=8080 maxRequestPerChild=500</span><br></pre></td></tr></table></figure>

<p>除了主机变量, 还有组变量, 也就是属于一个组的变量:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[webservers]</span><br><span class="line">www[1:10].justin.com</span><br><span class="line"></span><br><span class="line">[webservers:vars]</span><br><span class="line">nfs_server=nfs.justin.com</span><br><span class="line">ntp_server=ntp.justin.com</span><br></pre></td></tr></table></figure>

<p>另外, Inventory还可以进行组嵌套:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Group1]</span><br><span class="line">www.douban.com</span><br><span class="line">www.zhihu.com</span><br><span class="line"></span><br><span class="line">[Group2]</span><br><span class="line">www.sciencenet.cn</span><br><span class="line">www.weather.com.cn</span><br><span class="line"></span><br><span class="line">[target:children]</span><br><span class="line">Group1</span><br><span class="line">Group2</span><br><span class="line"></span><br><span class="line">[target:vars]</span><br><span class="line">var=XXX</span><br></pre></td></tr></table></figure>

<p>还有一些属于Inventory的变量, 例如<code>ansible_ssh_port, ansible_ssh_host, ansible_ssh_pass</code>等等. </p>
<p>现在我们来看一个playbook的示例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webnodes</span> <span class="comment"># 指明在哪些主机执行</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">http_port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">max_client:</span> <span class="number">256</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span> <span class="comment"># 指明是用什么用户的身份执行, 在tasks中也可以定义每一个task单独的执行者</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">ver.</span></span><br><span class="line">    <span class="attr">yum:</span> <span class="string">name=httpd</span> <span class="string">state=latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">name=httpd</span> <span class="string">state=started</span></span><br><span class="line">  <span class="attr">Handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">apache</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=httpd</span> <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure>

<p>tasks就是任务了, 调用模块完成操作, vars就是声明变量的区域, handlers就是由某事件触发的一些处理器. 最后的roles就是角色之意. 我们继续往后.</p>
<p>先不说后面的处理器, 我们来写一个简单的playbook执行试试.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- hosts: testservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars:</span><br><span class="line">    ntp_server: edu.ntp.org.cn</span><br><span class="line">  tasks:</span><br><span class="line">  - name: install ntp client</span><br><span class="line">    yum: name=ntp state=latest</span><br><span class="line">  - name: update time immediately</span><br><span class="line">    <span class="built_in">command</span>: <span class="string">&quot;ntpdate &#123;&#123; ntp_server &#125;&#125;&quot;</span></span><br><span class="line">  - name: create cron</span><br><span class="line">    cron: hour=*/12 job=<span class="string">&quot;ntpdate &#123;&#123; ntp_server &#125;&#125;&quot;</span> name=ntp_sync state=present</span><br></pre></td></tr></table></figure>

<p>很简单的一个剧本, 就是安装ntp接着进行时间同步, 定制定时任务以及显示当前的时间.</p>
<p>我们来执行一下看看:</p>
<blockquote>
<p>执行playbook的时候, 我们使用ansible-playbook程序, 最直接的方法就是在后面跟上yml的playbook文件, 也可以使用-e(添加额外变量)等选项. 另外这个地方我把testservers的inventory做了一下小修改:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[testservers]</span></span><br><span class="line">VM-node<span class="section">[2:3]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[webservers]</span></span><br><span class="line">192.168.206.22</span><br><span class="line">192.168.206.10</span><br></pre></td></tr></table></figure>
</blockquote>
<p>就是这样的效果, 很简单吧:</p>
<p><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook2.png" alt="ansible-playbook2"></p>
<p>再来写一个和tinyproxy相关的playbook, 接着引出我们的handler, </p>
<p><code>web_tinyproxy.yml</code>内容如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">testservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">tinyproxy</span> <span class="string">service</span></span><br><span class="line">    <span class="attr">yum:</span> <span class="string">name=tinyproxy</span> <span class="string">state=latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">configuration</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">copy:</span> <span class="string">src=/etc/tinyproxy/tinyproxy.conf</span> <span class="string">dest=/etc/tinyproxy/tinyproxy.conf</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">tinyproxy</span> <span class="string">service</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">name=tinyproxy</span> <span class="string">state=started</span></span><br></pre></td></tr></table></figure>

<p>执行效果: </p>
<p><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook3.png" alt="ansible-playbook3"></p>
<p>有意思的是, 现在的配置文件监听端口是<code>2333</code>, 我们来验证一下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible testservers -m shell -a &quot;ss -tnl | grep 2333&quot;</span></span><br><span class="line">VM-node3 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">0      128                      *:2333                    *:*     </span><br><span class="line"></span><br><span class="line">VM-node2 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">LISTEN     0      128          *:2333                     *:*      </span><br></pre></td></tr></table></figure>

<p>接着我们修改一下本地的配置, 将端口换成<code>23333</code>: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># sed -i &#x27;s/2333/23333/&#x27; /etc/tinyproxy/tinyproxy.conf </span></span><br></pre></td></tr></table></figure>

<p>再次执行一次playbook:</p>
<p><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook4.png" alt="ansible-playbook4"></p>
<p>从转型结果我们可以看出来, 服务并没有得到重启. 尽管我们的配置文件是已经重新复制了( 因为文件被修改了 ). 这个时候就需要我们的Handler来根据task的执行情况来触发特定的task.</p>
<p>说来也简单, 当我们的配置文件被修改的时候, 显然是应该重启服务的, 所以我们应该<strong>通知</strong>一下, 从而去执行特定的操作, handler和我们的tasks同级别, 如果没有人**通知(notify)**它. 就不会执行里面的任务, 通知的方式就是通过notify关键字, 指明哪一个handler, 直接看我们的实例吧:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- hosts: testservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Install tinyproxy service</span><br><span class="line">    yum: name=tinyproxy state=latest</span><br><span class="line">  - name: Copy configuration file</span><br><span class="line">    copy: src=/etc/tinyproxy/tinyproxy.conf dest=/etc/tinyproxy/tinyproxy.conf</span><br><span class="line">    notify:</span><br><span class="line">    - restart tinyproxy</span><br><span class="line">  - name: Start tinyproxy service</span><br><span class="line">    service: name=tinyproxy state=started</span><br><span class="line">  handlers:</span><br><span class="line">  - name: restart tinyproxy</span><br><span class="line">    service: name=tinyproxy state=restarted</span><br></pre></td></tr></table></figure>

<p>这个时候, 我们还需要修改一下配置文件, 比如随便再把端口换一换, 9990吧. 接着再次执行一次:<br><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook6.png" alt="ansible-playbook6"></p>
<p>多了一个<code>RUNNING HANDLER</code>吧. 这个时候看一下, 端口也确实是改变了.</p>
<p>另外, 我们的playbook中还可以使用条件测试, 通过when关键字可以根据具体的一些情况来选择性的执行, 来看这样的一个playbook</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@VM-node1</span> <span class="string">~</span>]<span class="comment"># cat test.yml </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">testservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">make</span> <span class="string">a</span> <span class="string">test</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">content=&quot;This</span> <span class="string">is</span> <span class="string">CentOS7&quot;</span> <span class="string">dest=/tmp/version.ansible</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_distribution_major_version</span> <span class="string">==</span> <span class="string">&quot;7&quot;</span></span><br></pre></td></tr></table></figure>

<p>执行之后就是这样的了:<br><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook7.png" alt="ansible-playbook7"></p>
<p>其中<code>ansible_distribution_major_version</code>是fact中的变量, 我们可以直接进行引用. </p>
<p>从结果看出来了, 因为我们的两个节点一个是CentOS7, 一个是 CentOS6, 所以仅仅执行了一个.</p>
<p>除了条件测试 , playbook还可以使用迭代, 就像这样:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">testservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">users</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">name=&#123;&#123;</span> <span class="string">item.name</span> <span class="string">&#125;&#125;</span> <span class="string">groups=&#123;&#123;</span> <span class="string">item.groups</span> <span class="string">&#125;&#125;</span> <span class="string">state=present</span></span><br><span class="line">      <span class="attr">with-items:</span></span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;test1&#x27;</span>, <span class="attr">groups:</span> <span class="string">&#x27;wheel&#x27;</span> &#125;</span><br><span class="line">        <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;test2&#x27;</span>, <span class="attr">groups:</span> <span class="string">&#x27;testgroup&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>其中, item是一个固定的变量, 会从with-items中定义的变量中取值. 不仅如此, 我们的变量可以通过字典的形式来取值.</p>
<p>上面的迭代展开, 其实就像是两个差不多的task. 这样写就更加简洁.</p>
<p>接下来, 我们再来了解一下Jinja2的模板语言. 由于Ansible使用的就是Jinja2, 所以支持Jinja2的各种语法. 不过说真的, 用的地方用的不是很多, 我们使用最多的地方应该就是变量替换了吧.</p>
<p>来看看一个配置文件好了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Listen &#123;&#123; port &#125;&#125;</span><br><span class="line">ServerName &#123;&#123; servername &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>还记得我们说过的Inventory中的变量吗, 在这里就可以派上用场了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[webservers]</span><br><span class="line">192.168.206.22 port=80 servername=VM-node3</span><br><span class="line">192.168.206.10 port=8080 servername=VM-node2</span><br></pre></td></tr></table></figure>

<p>这样我们就可以通过模板这个模块来展开变量, 从而达到不同配置的需求.</p>
<p>接着我们看一下Tag功能, 如果只想运行一个playbook中的一个单独的或者特定的task, 我们可以在task中写上tags关键字:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- hosts: webservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Install httpd service</span><br><span class="line">    yum: name=httpd state=latest</span><br><span class="line">  - name: Copy configuration file</span><br><span class="line">    template: src=/root/templates/httpd.j2 dest=/etc/httpd/conf/httpd.conf</span><br><span class="line">  - name: Ensure apache service is running</span><br><span class="line">    service: name=httpd state=restarted</span><br></pre></td></tr></table></figure>

<p>假设说每次执行这个playbook他都会从头执行到尾, 但是假设我现在就指向执行其中的复制和重启, 而不像执行安装的话, 怎么办呢? 我们在template和service下加上tags关键字:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- hosts: testservers</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Install tinyproxy service</span><br><span class="line">    yum: name=tinyproxy state=latest</span><br><span class="line">  - name: Copy configuration file</span><br><span class="line">    copy: src=/etc/tinyproxy/tinyproxy.conf dest=/etc/tinyproxy/tinyproxy.conf</span><br><span class="line">    notify:</span><br><span class="line">    - restart tinyproxy</span><br><span class="line">    tags:</span><br><span class="line">    - skip-install</span><br><span class="line">  - name: Start tinyproxy service</span><br><span class="line">    service: name=tinyproxy state=started</span><br><span class="line">  handlers:</span><br><span class="line">  - name: restart tinyproxy</span><br><span class="line">    service: name=tinyproxy state=restarted</span><br></pre></td></tr></table></figure>

<p>我们在复制文件的那个地方加入了tags, 接着我们执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-node1 ~]<span class="comment"># ansible-playbook web_tinyproxy.yml --tags=&#x27;skip-install&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://hexopic.s3-ap-northeast-1.amazonaws.com/ansible-playbook8.png" alt="ansible-playbook8"></p>
<p>看, 只有加上tag的那一个任务才会执行.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">Tags</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/photography/">photography</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">自动化运维相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">Ansible入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron"><span class="toc-number">2.1.</span> <span class="toc-text">cron</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user"><span class="toc-number">2.2.</span> <span class="toc-text">user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group"><span class="toc-number">2.3.</span> <span class="toc-text">group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy"><span class="toc-number">2.4.</span> <span class="toc-text">copy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file"><span class="toc-number">2.5.</span> <span class="toc-text">file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping"><span class="toc-number">2.6.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service"><span class="toc-number">2.7.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell"><span class="toc-number">2.8.</span> <span class="toc-text">shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#script"><span class="toc-number">2.9.</span> <span class="toc-text">script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yum"><span class="toc-number">2.10.</span> <span class="toc-text">yum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup"><span class="toc-number">2.11.</span> <span class="toc-text">setup</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML"><span class="toc-number">3.</span> <span class="toc-text">YAML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Playbook"><span class="toc-number">4.</span> <span class="toc-text">Playbook</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&text=自动化运维之Ansible"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&is_video=false&description=自动化运维之Ansible"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=自动化运维之Ansible&body=Check out this article: https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&title=自动化运维之Ansible"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&name=自动化运维之Ansible&description=&lt;p&gt;自动化运维第一步, 走起.&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://19971122.xyz/2017/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible/&t=自动化运维之Ansible"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    Yaoxuan Wei
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/photography/">photography</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'yaoxuannn-com';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

<script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
